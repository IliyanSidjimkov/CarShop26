@model DetailsViewModel
@using System.Security.Claims

@{
    Layout = "_Layout";
    bool isOwner = User.Identity?.IsAuthenticated == true
                  && User.FindFirst(ClaimTypes.NameIdentifier)?.Value == Model.OwnerId;

    string imageSrc = string.IsNullOrWhiteSpace(Model.ImageUrl)
        ? Url.Content("~/images/placeholder-car.png")
        : Model.ImageUrl;
}

<div class="container my-5">
    <div class="row g-4 align-items-start details-wrapper">

        
        <div class="col-md-5">
            <div class="card details-image-card shadow-sm border-0">
                <img src="@imageSrc"
                     class="card-img-top img-fluid rounded-4"
                     alt="@($"{Model.Brand} {Model.Model}")"
                     onerror="this.onerror=null;this.src='@Url.Content("~/images/placeholder-car.png")';" />
            </div>
        </div>

        
        <div class="col-md-7">
            <div class="details-info-card p-4 rounded-4 shadow-sm bg-white">

                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h2 class="fw-bold mb-1">
                            @Model.Brand @Model.Model
                            <small class="text-muted">(@Model.Year)</small>
                        </h2>
                        <h4 class="price mb-3">@Model.Price.ToString("N2") €</h4>
                    </div>
                </div>

                <div class="d-flex flex-wrap gap-2 mb-3">
                    <span class="badge bg-primary">🚗 @Model.Category</span>
                    <span class="badge bg-secondary">⛽ @Model.FuelType</span>
                    <span class="badge bg-info text-dark">⚙️ @Model.GearboxType</span>
                    <span class="badge bg-dark">📍 @Model.City</span>
                </div>

                <dl class="row details-list">
                    <dt class="col-sm-4">Mileage</dt>
                    <dd class="col-sm-8">@Model.Mileage km</dd>

                    <dt class="col-sm-4">Fuel Type</dt>
                    <dd class="col-sm-8">@Model.FuelType</dd>

                    <dt class="col-sm-4">Gearbox</dt>
                    <dd class="col-sm-8">@Model.GearboxType</dd>

                    <dt class="col-sm-4">City</dt>
                    <dd class="col-sm-8">@Model.City</dd>

                    <dt class="col-sm-4">Category</dt>
                    <dd class="col-sm-8">@Model.Category</dd>

                    <dt class="col-sm-4">Owner</dt>
                    <dd class="col-sm-8">@Model.OwnerName</dd>

                    <dt class="col-sm-4">Published on</dt>
                    <dd class="col-sm-8">@Model.CreatedOn.ToString("dd.MM.yyyy HH:mm")</dd>
                </dl>

                <div class="mt-4 d-flex flex-wrap gap-2">
                    <a href="@(ViewBag.ReturnUrl ?? Url.Action("AllCars", "Car"))"
                       class="btn btn-outline-primary">
                         Back to list
                    </a>
                  

                    @if (isOwner)
                    {
                        
                        <a asp-controller="Car"
                           asp-action="Edit"
                           asp-route-id="@Model.Id"
                           asp-route-returnUrl="@(Context.Request.Path + Context.Request.QueryString)"
                           class="btn btn-warning ">
                            Edit
                        </a>
  
                        <form method="post"
                              action="@Url.Action("Delete", "Car", new { id = Model.Id })">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-danger">
                                Delete
                            </button>
                        </form>
                    }
                </div>

            </div>
        </div>
    </div>
</div>
